webpackJsonp([47],{Oe5E:function(t,s){},YrOL:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i={data:function(){return{starIndex:-1,title:"发表评价",textValue:"",imgList:[],fileList:[],urlList:[],upLoadUrlList:[],imgIdList:[]}},components:{CommonHeader:e("i2Wk").a},computed:{isComplete:function(){return this.textValue.length>0&&-1!=this.starIndex}},methods:{selectStar:function(t){this.starIndex=t},uploadImg:function(){var t=this,s=document.getElementById("publish-img").files[0],e=s.name;this.fileList.push(s),this.oFile=s,this.filename=e;var i={a:1,type:1,filename:e,oFile:s};this.getExternalUploadObject(i);var a=new FileReader;a.readAsDataURL(s),a.onload=function(e){var i=e.currentTarget.result;t.imgList.push(i),s.value="",document.getElementById("publish-img").value=""}},delImg:function(t,s){this.imgList.splice(s,1),this.urlList.splice(s,1),this.fileList.splice(s,1)},getExternalUploadObject:function(t){var s=this;this.$Api.getExternalUploadObject(t).then(function(t){if(console.log(t),0==t.q.s){s.cos=t.q.cos;var e={accessUrl:t.q.cos.accessUrl,sourceUrl:t.q.cos.sourceUrl};console.log(e),s.urlList.push(e),s.upLoadUrlList.push(t.q.cos.url)}})},getExternalFilesSubmit:function(){var t=this,s=this,e=[];this.urlList.forEach(function(t){var s={accessUrl:t.accessUrl,sourceUrl:t.sourceUrl};e.push(s)}),console.log(e),this.$Api.getExternalFilesSubmit(1,1,e).then(function(e){if(console.log(e),0==e.q.s){e.q.files.forEach(function(s){console.log(s.id),t.imgIdList.push(s.id)});for(var i=0;i<t.fileList.length;i++)s.$upLoadToCos(t.upLoadUrlList[i],t.fileList[i]);t.getCommentSubmit()}})},commentSubmit:function(){this.isComplete&&this.getExternalFilesSubmit()},getCommentSubmit:function(){var t=this.$route.params.id,s=[],e={userId:0,starNum:this.starIndex,content:this.textValue,imageIds:this.imgIdList};s.push(e),this.$Api.CommentSubmit(11,t,s).then(function(t){console.log(t)})}}},a={render:function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{attrs:{id:"publish"}},[i("common-header",{attrs:{title:t.title}}),t._v(" "),i("div",{staticClass:"publish-content"},[i("div",{staticClass:"publish-text"},[i("img",{staticClass:"goods-img",attrs:{src:e("o3Ya")}}),t._v(" "),i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.textValue,expression:"textValue"}],attrs:{placeholder:"礼物怎么样？说说您的看法吧~"},domProps:{value:t.textValue},on:{input:function(s){s.target.composing||(t.textValue=s.target.value)}}})]),t._v(" "),i("div",{staticClass:"publish-imgs clearfix"},[i("ul",{staticClass:"clearfix"},[t._l(t.imgList,function(s,a){return i("li",[i("img",{staticClass:"publish-icon",attrs:{src:s}}),t._v(" "),i("div",{staticClass:"del-btn",on:{click:function(e){t.delImg(s,a)}}},[i("img",{attrs:{src:e("Xmmv")}})])])}),t._v(" "),i("li",{directives:[{name:"show",rawName:"v-show",value:t.imgList.length<6,expression:"imgList.length<6"}]},[i("img",{staticClass:"publish-icon",attrs:{src:e("rGQL")}}),t._v(" "),i("input",{ref:"imgInput",attrs:{type:"file",accept:"image/*",name:"file[]",id:"publish-img"},on:{change:function(s){t.uploadImg(s)}}})])],2)])]),t._v(" "),i("div",{staticClass:"publish-score"},[i("span",[t._v("评分")]),t._v(" "),i("span",[i("i",{staticClass:"star",class:{active:t.starIndex>=1},on:{click:function(s){t.selectStar(1)}}}),t._v(" "),i("i",{staticClass:"star",class:{active:t.starIndex>=2},on:{click:function(s){t.selectStar(2)}}}),t._v(" "),i("i",{staticClass:"star",class:{active:t.starIndex>=3},on:{click:function(s){t.selectStar(3)}}}),t._v(" "),i("i",{staticClass:"star",class:{active:t.starIndex>=4},on:{click:function(s){t.selectStar(4)}}}),t._v(" "),i("i",{staticClass:"star",class:{active:t.starIndex>=5},on:{click:function(s){t.selectStar(5)}}})])]),t._v(" "),i("div",{staticClass:"publish-btn",class:{active:t.isComplete},on:{click:t.commentSubmit}},[t._v("发表评价")])],1)},staticRenderFns:[]},l=e("OF7X")(i,a,!1,function(t){e("Oe5E")},null,null);s.default=l.exports}});
//# sourceMappingURL=47.8b9c859d3c9e1c5527bb.js.map